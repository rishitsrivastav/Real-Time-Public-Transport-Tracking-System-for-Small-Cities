{"dependencies":[{"name":"@babel/runtime/helpers/interopRequireDefault","data":{"asyncType":null,"isESMImport":false,"locs":[],"key":"kslwqCIsh6ew+I1KeA1rlVRjsAk=","exportNames":["*"]}},{"name":"@react-native-async-storage/async-storage","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":1,"column":0,"index":0},"end":{"line":1,"column":69,"index":69}}],"key":"0kSRlooyBOaYM9tlTtK91nq+uds=","exportNames":["*"]}},{"name":"./api","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":2,"column":0,"index":70},"end":{"line":2,"column":58,"index":128}}],"key":"FbKPDeRJ9TF3vg1eKYKz12urgic=","exportNames":["*"]}}],"output":[{"data":{"code":"__d(function (global, require, _$$_IMPORT_DEFAULT, _$$_IMPORT_ALL, module, exports, _dependencyMap) {\n  var _interopRequireDefault = require(_dependencyMap[0], \"@babel/runtime/helpers/interopRequireDefault\");\n  Object.defineProperty(exports, \"__esModule\", {\n    value: true\n  });\n  exports.removeFromQueue = exports.getQueueLength = exports.getQueue = exports.flushQueue = exports.clearQueue = exports.addToQueue = void 0;\n  var _asyncStorage = _interopRequireDefault(require(_dependencyMap[1], \"@react-native-async-storage/async-storage\"));\n  var _api = require(_dependencyMap[2], \"./api\");\n  const QUEUE_KEY = 'pendingLocationUpdates';\n  const addToQueue = async locationUpdate => {\n    try {\n      const existingQueue = await getQueue();\n      const queuedUpdate = {\n        ...locationUpdate,\n        timestamp: Date.now(),\n        retryCount: 0\n      };\n      const updatedQueue = [...existingQueue, queuedUpdate];\n      await _asyncStorage.default.setItem(QUEUE_KEY, JSON.stringify(updatedQueue));\n      console.log('Added location update to queue:', queuedUpdate);\n    } catch (error) {\n      console.error('Error adding to queue:', error);\n    }\n  };\n  exports.addToQueue = addToQueue;\n  const getQueue = async () => {\n    try {\n      const queueData = await _asyncStorage.default.getItem(QUEUE_KEY);\n      return queueData ? JSON.parse(queueData) : [];\n    } catch (error) {\n      console.error('Error getting queue:', error);\n      return [];\n    }\n  };\n  exports.getQueue = getQueue;\n  const removeFromQueue = async timestamp => {\n    try {\n      const queue = await getQueue();\n      const updatedQueue = queue.filter(item => item.timestamp !== timestamp);\n      await _asyncStorage.default.setItem(QUEUE_KEY, JSON.stringify(updatedQueue));\n      console.log('Removed item from queue with timestamp:', timestamp);\n    } catch (error) {\n      console.error('Error removing from queue:', error);\n    }\n  };\n  exports.removeFromQueue = removeFromQueue;\n  const flushQueue = async () => {\n    try {\n      const queue = await getQueue();\n      console.log(`Flushing queue with ${queue.length} items`);\n      if (queue.length === 0) {\n        return;\n      }\n      const successfulUpdates = [];\n      const failedUpdates = [];\n\n      // Process each queued update\n      for (const queuedUpdate of queue) {\n        try {\n          // Try to send the location update\n          await (0, _api.updateBusLocation)({\n            busId: queuedUpdate.busId,\n            lat: queuedUpdate.lat,\n            lng: queuedUpdate.lng,\n            speed: queuedUpdate.speed\n          });\n\n          // If successful, mark for removal\n          successfulUpdates.push(queuedUpdate.timestamp);\n          console.log('Successfully sent queued location update:', queuedUpdate.timestamp);\n        } catch (error) {\n          console.error('Failed to send queued update:', error);\n\n          // Increment retry count\n          const updatedItem = {\n            ...queuedUpdate,\n            retryCount: queuedUpdate.retryCount + 1\n          };\n\n          // Only keep items that haven't exceeded max retries (5 attempts)\n          if (updatedItem.retryCount < 5) {\n            failedUpdates.push(updatedItem);\n          } else {\n            console.log('Max retries exceeded for item:', queuedUpdate.timestamp);\n          }\n        }\n      }\n\n      // Update the queue with only failed items (that haven't exceeded retries)\n      await _asyncStorage.default.setItem(QUEUE_KEY, JSON.stringify(failedUpdates));\n      console.log(`Queue flush complete. Sent: ${successfulUpdates.length}, Failed: ${failedUpdates.length}`);\n    } catch (error) {\n      console.error('Error flushing queue:', error);\n    }\n  };\n  exports.flushQueue = flushQueue;\n  const clearQueue = async () => {\n    try {\n      await _asyncStorage.default.removeItem(QUEUE_KEY);\n      console.log('Queue cleared');\n    } catch (error) {\n      console.error('Error clearing queue:', error);\n    }\n  };\n  exports.clearQueue = clearQueue;\n  const getQueueLength = async () => {\n    try {\n      const queue = await getQueue();\n      return queue.length;\n    } catch (error) {\n      console.error('Error getting queue length:', error);\n      return 0;\n    }\n  };\n  exports.getQueueLength = getQueueLength;\n});","lineCount":116,"map":[[7,2,1,0],[7,6,1,0,"_asyncStorage"],[7,19,1,0],[7,22,1,0,"_interopRequireDefault"],[7,44,1,0],[7,45,1,0,"require"],[7,52,1,0],[7,53,1,0,"_dependencyMap"],[7,67,1,0],[8,2,2,0],[8,6,2,0,"_api"],[8,10,2,0],[8,13,2,0,"require"],[8,20,2,0],[8,21,2,0,"_dependencyMap"],[8,35,2,0],[9,2,4,0],[9,8,4,6,"QUEUE_KEY"],[9,17,4,15],[9,20,4,18],[9,44,4,42],[10,2,11,7],[10,8,11,13,"addToQueue"],[10,18,11,23],[10,21,11,26],[10,27,11,33,"locationUpdate"],[10,41,11,63],[10,45,11,83],[11,4,12,2],[11,8,12,6],[12,6,13,4],[12,12,13,10,"existingQueue"],[12,25,13,23],[12,28,13,26],[12,34,13,32,"getQueue"],[12,42,13,40],[12,43,13,41],[12,44,13,42],[13,6,14,4],[13,12,14,10,"queuedUpdate"],[13,24,14,44],[13,27,14,47],[14,8,15,6],[14,11,15,9,"locationUpdate"],[14,25,15,23],[15,8,16,6,"timestamp"],[15,17,16,15],[15,19,16,17,"Date"],[15,23,16,21],[15,24,16,22,"now"],[15,27,16,25],[15,28,16,26],[15,29,16,27],[16,8,17,6,"retryCount"],[16,18,17,16],[16,20,17,18],[17,6,18,4],[17,7,18,5],[18,6,20,4],[18,12,20,10,"updatedQueue"],[18,24,20,22],[18,27,20,25],[18,28,20,26],[18,31,20,29,"existingQueue"],[18,44,20,42],[18,46,20,44,"queuedUpdate"],[18,58,20,56],[18,59,20,57],[19,6,21,4],[19,12,21,10,"AsyncStorage"],[19,33,21,22],[19,34,21,23,"setItem"],[19,41,21,30],[19,42,21,31,"QUEUE_KEY"],[19,51,21,40],[19,53,21,42,"JSON"],[19,57,21,46],[19,58,21,47,"stringify"],[19,67,21,56],[19,68,21,57,"updatedQueue"],[19,80,21,69],[19,81,21,70],[19,82,21,71],[20,6,22,4,"console"],[20,13,22,11],[20,14,22,12,"log"],[20,17,22,15],[20,18,22,16],[20,51,22,49],[20,53,22,51,"queuedUpdate"],[20,65,22,63],[20,66,22,64],[21,4,23,2],[21,5,23,3],[21,6,23,4],[21,13,23,11,"error"],[21,18,23,16],[21,20,23,18],[22,6,24,4,"console"],[22,13,24,11],[22,14,24,12,"error"],[22,19,24,17],[22,20,24,18],[22,44,24,42],[22,46,24,44,"error"],[22,51,24,49],[22,52,24,50],[23,4,25,2],[24,2,26,0],[24,3,26,1],[25,2,26,2,"exports"],[25,9,26,2],[25,10,26,2,"addToQueue"],[25,20,26,2],[25,23,26,2,"addToQueue"],[25,33,26,2],[26,2,28,7],[26,8,28,13,"getQueue"],[26,16,28,21],[26,19,28,24],[26,25,28,24,"getQueue"],[26,26,28,24],[26,31,28,69],[27,4,29,2],[27,8,29,6],[28,6,30,4],[28,12,30,10,"queueData"],[28,21,30,19],[28,24,30,22],[28,30,30,28,"AsyncStorage"],[28,51,30,40],[28,52,30,41,"getItem"],[28,59,30,48],[28,60,30,49,"QUEUE_KEY"],[28,69,30,58],[28,70,30,59],[29,6,31,4],[29,13,31,11,"queueData"],[29,22,31,20],[29,25,31,23,"JSON"],[29,29,31,27],[29,30,31,28,"parse"],[29,35,31,33],[29,36,31,34,"queueData"],[29,45,31,43],[29,46,31,44],[29,49,31,47],[29,51,31,49],[30,4,32,2],[30,5,32,3],[30,6,32,4],[30,13,32,11,"error"],[30,18,32,16],[30,20,32,18],[31,6,33,4,"console"],[31,13,33,11],[31,14,33,12,"error"],[31,19,33,17],[31,20,33,18],[31,42,33,40],[31,44,33,42,"error"],[31,49,33,47],[31,50,33,48],[32,6,34,4],[32,13,34,11],[32,15,34,13],[33,4,35,2],[34,2,36,0],[34,3,36,1],[35,2,36,2,"exports"],[35,9,36,2],[35,10,36,2,"getQueue"],[35,18,36,2],[35,21,36,2,"getQueue"],[35,29,36,2],[36,2,38,7],[36,8,38,13,"removeFromQueue"],[36,23,38,28],[36,26,38,31],[36,32,38,38,"timestamp"],[36,41,38,55],[36,45,38,75],[37,4,39,2],[37,8,39,6],[38,6,40,4],[38,12,40,10,"queue"],[38,17,40,15],[38,20,40,18],[38,26,40,24,"getQueue"],[38,34,40,32],[38,35,40,33],[38,36,40,34],[39,6,41,4],[39,12,41,10,"updatedQueue"],[39,24,41,22],[39,27,41,25,"queue"],[39,32,41,30],[39,33,41,31,"filter"],[39,39,41,37],[39,40,41,38,"item"],[39,44,41,42],[39,48,41,46,"item"],[39,52,41,50],[39,53,41,51,"timestamp"],[39,62,41,60],[39,67,41,65,"timestamp"],[39,76,41,74],[39,77,41,75],[40,6,42,4],[40,12,42,10,"AsyncStorage"],[40,33,42,22],[40,34,42,23,"setItem"],[40,41,42,30],[40,42,42,31,"QUEUE_KEY"],[40,51,42,40],[40,53,42,42,"JSON"],[40,57,42,46],[40,58,42,47,"stringify"],[40,67,42,56],[40,68,42,57,"updatedQueue"],[40,80,42,69],[40,81,42,70],[40,82,42,71],[41,6,43,4,"console"],[41,13,43,11],[41,14,43,12,"log"],[41,17,43,15],[41,18,43,16],[41,59,43,57],[41,61,43,59,"timestamp"],[41,70,43,68],[41,71,43,69],[42,4,44,2],[42,5,44,3],[42,6,44,4],[42,13,44,11,"error"],[42,18,44,16],[42,20,44,18],[43,6,45,4,"console"],[43,13,45,11],[43,14,45,12,"error"],[43,19,45,17],[43,20,45,18],[43,48,45,46],[43,50,45,48,"error"],[43,55,45,53],[43,56,45,54],[44,4,46,2],[45,2,47,0],[45,3,47,1],[46,2,47,2,"exports"],[46,9,47,2],[46,10,47,2,"removeFromQueue"],[46,25,47,2],[46,28,47,2,"removeFromQueue"],[46,43,47,2],[47,2,49,7],[47,8,49,13,"flushQueue"],[47,18,49,23],[47,21,49,26],[47,27,49,26,"flushQueue"],[47,28,49,26],[47,33,49,53],[48,4,50,2],[48,8,50,6],[49,6,51,4],[49,12,51,10,"queue"],[49,17,51,15],[49,20,51,18],[49,26,51,24,"getQueue"],[49,34,51,32],[49,35,51,33],[49,36,51,34],[50,6,52,4,"console"],[50,13,52,11],[50,14,52,12,"log"],[50,17,52,15],[50,18,52,16],[50,41,52,39,"queue"],[50,46,52,44],[50,47,52,45,"length"],[50,53,52,51],[50,61,52,59],[50,62,52,60],[51,6,54,4],[51,10,54,8,"queue"],[51,15,54,13],[51,16,54,14,"length"],[51,22,54,20],[51,27,54,25],[51,28,54,26],[51,30,54,28],[52,8,55,6],[53,6,56,4],[54,6,58,4],[54,12,58,10,"successfulUpdates"],[54,29,58,37],[54,32,58,40],[54,34,58,42],[55,6,59,4],[55,12,59,10,"failedUpdates"],[55,25,59,47],[55,28,59,50],[55,30,59,52],[57,6,61,4],[58,6,62,4],[58,11,62,9],[58,17,62,15,"queuedUpdate"],[58,29,62,27],[58,33,62,31,"queue"],[58,38,62,36],[58,40,62,38],[59,8,63,6],[59,12,63,10],[60,10,64,8],[61,10,65,8],[61,16,65,14],[61,20,65,14,"updateBusLocation"],[61,42,65,31],[61,44,65,32],[62,12,66,10,"busId"],[62,17,66,15],[62,19,66,17,"queuedUpdate"],[62,31,66,29],[62,32,66,30,"busId"],[62,37,66,35],[63,12,67,10,"lat"],[63,15,67,13],[63,17,67,15,"queuedUpdate"],[63,29,67,27],[63,30,67,28,"lat"],[63,33,67,31],[64,12,68,10,"lng"],[64,15,68,13],[64,17,68,15,"queuedUpdate"],[64,29,68,27],[64,30,68,28,"lng"],[64,33,68,31],[65,12,69,10,"speed"],[65,17,69,15],[65,19,69,17,"queuedUpdate"],[65,31,69,29],[65,32,69,30,"speed"],[66,10,70,8],[66,11,70,9],[66,12,70,10],[68,10,72,8],[69,10,73,8,"successfulUpdates"],[69,27,73,25],[69,28,73,26,"push"],[69,32,73,30],[69,33,73,31,"queuedUpdate"],[69,45,73,43],[69,46,73,44,"timestamp"],[69,55,73,53],[69,56,73,54],[70,10,74,8,"console"],[70,17,74,15],[70,18,74,16,"log"],[70,21,74,19],[70,22,74,20],[70,65,74,63],[70,67,74,65,"queuedUpdate"],[70,79,74,77],[70,80,74,78,"timestamp"],[70,89,74,87],[70,90,74,88],[71,8,75,6],[71,9,75,7],[71,10,75,8],[71,17,75,15,"error"],[71,22,75,20],[71,24,75,22],[72,10,76,8,"console"],[72,17,76,15],[72,18,76,16,"error"],[72,23,76,21],[72,24,76,22],[72,55,76,53],[72,57,76,55,"error"],[72,62,76,60],[72,63,76,61],[74,10,78,8],[75,10,79,8],[75,16,79,14,"updatedItem"],[75,27,79,25],[75,30,79,28],[76,12,80,10],[76,15,80,13,"queuedUpdate"],[76,27,80,25],[77,12,81,10,"retryCount"],[77,22,81,20],[77,24,81,22,"queuedUpdate"],[77,36,81,34],[77,37,81,35,"retryCount"],[77,47,81,45],[77,50,81,48],[78,10,82,8],[78,11,82,9],[80,10,84,8],[81,10,85,8],[81,14,85,12,"updatedItem"],[81,25,85,23],[81,26,85,24,"retryCount"],[81,36,85,34],[81,39,85,37],[81,40,85,38],[81,42,85,40],[82,12,86,10,"failedUpdates"],[82,25,86,23],[82,26,86,24,"push"],[82,30,86,28],[82,31,86,29,"updatedItem"],[82,42,86,40],[82,43,86,41],[83,10,87,8],[83,11,87,9],[83,17,87,15],[84,12,88,10,"console"],[84,19,88,17],[84,20,88,18,"log"],[84,23,88,21],[84,24,88,22],[84,56,88,54],[84,58,88,56,"queuedUpdate"],[84,70,88,68],[84,71,88,69,"timestamp"],[84,80,88,78],[84,81,88,79],[85,10,89,8],[86,8,90,6],[87,6,91,4],[89,6,93,4],[90,6,94,4],[90,12,94,10,"AsyncStorage"],[90,33,94,22],[90,34,94,23,"setItem"],[90,41,94,30],[90,42,94,31,"QUEUE_KEY"],[90,51,94,40],[90,53,94,42,"JSON"],[90,57,94,46],[90,58,94,47,"stringify"],[90,67,94,56],[90,68,94,57,"failedUpdates"],[90,81,94,70],[90,82,94,71],[90,83,94,72],[91,6,96,4,"console"],[91,13,96,11],[91,14,96,12,"log"],[91,17,96,15],[91,18,96,16],[91,49,96,47,"successfulUpdates"],[91,66,96,64],[91,67,96,65,"length"],[91,73,96,71],[91,86,96,84,"failedUpdates"],[91,99,96,97],[91,100,96,98,"length"],[91,106,96,104],[91,108,96,106],[91,109,96,107],[92,4,97,2],[92,5,97,3],[92,6,97,4],[92,13,97,11,"error"],[92,18,97,16],[92,20,97,18],[93,6,98,4,"console"],[93,13,98,11],[93,14,98,12,"error"],[93,19,98,17],[93,20,98,18],[93,43,98,41],[93,45,98,43,"error"],[93,50,98,48],[93,51,98,49],[94,4,99,2],[95,2,100,0],[95,3,100,1],[96,2,100,2,"exports"],[96,9,100,2],[96,10,100,2,"flushQueue"],[96,20,100,2],[96,23,100,2,"flushQueue"],[96,33,100,2],[97,2,102,7],[97,8,102,13,"clearQueue"],[97,18,102,23],[97,21,102,26],[97,27,102,26,"clearQueue"],[97,28,102,26],[97,33,102,53],[98,4,103,2],[98,8,103,6],[99,6,104,4],[99,12,104,10,"AsyncStorage"],[99,33,104,22],[99,34,104,23,"removeItem"],[99,44,104,33],[99,45,104,34,"QUEUE_KEY"],[99,54,104,43],[99,55,104,44],[100,6,105,4,"console"],[100,13,105,11],[100,14,105,12,"log"],[100,17,105,15],[100,18,105,16],[100,33,105,31],[100,34,105,32],[101,4,106,2],[101,5,106,3],[101,6,106,4],[101,13,106,11,"error"],[101,18,106,16],[101,20,106,18],[102,6,107,4,"console"],[102,13,107,11],[102,14,107,12,"error"],[102,19,107,17],[102,20,107,18],[102,43,107,41],[102,45,107,43,"error"],[102,50,107,48],[102,51,107,49],[103,4,108,2],[104,2,109,0],[104,3,109,1],[105,2,109,2,"exports"],[105,9,109,2],[105,10,109,2,"clearQueue"],[105,20,109,2],[105,23,109,2,"clearQueue"],[105,33,109,2],[106,2,111,7],[106,8,111,13,"getQueueLength"],[106,22,111,27],[106,25,111,30],[106,31,111,30,"getQueueLength"],[106,32,111,30],[106,37,111,59],[107,4,112,2],[107,8,112,6],[108,6,113,4],[108,12,113,10,"queue"],[108,17,113,15],[108,20,113,18],[108,26,113,24,"getQueue"],[108,34,113,32],[108,35,113,33],[108,36,113,34],[109,6,114,4],[109,13,114,11,"queue"],[109,18,114,16],[109,19,114,17,"length"],[109,25,114,23],[110,4,115,2],[110,5,115,3],[110,6,115,4],[110,13,115,11,"error"],[110,18,115,16],[110,20,115,18],[111,6,116,4,"console"],[111,13,116,11],[111,14,116,12,"error"],[111,19,116,17],[111,20,116,18],[111,49,116,47],[111,51,116,49,"error"],[111,56,116,54],[111,57,116,55],[112,6,117,4],[112,13,117,11],[112,14,117,12],[113,4,118,2],[114,2,119,0],[114,3,119,1],[115,2,119,2,"exports"],[115,9,119,2],[115,10,119,2,"getQueueLength"],[115,24,119,2],[115,27,119,2,"getQueueLength"],[115,41,119,2],[116,0,119,2],[116,3]],"functionMap":{"names":["<global>","addToQueue","getQueue","removeFromQueue","filter$argument_0","flushQueue","clearQueue","getQueueLength"],"mappings":"AAA;0BCU;CDe;wBEE;CFQ;+BGE;sCCG,oCD;CHM;0BKE;CLmD;0BME;CNO;8BOE;CPQ"}},"type":"js/module"}]}